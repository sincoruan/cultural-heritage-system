# 文化遗产管理系统 - 部署指南

## 🚀 部署方式选择

### 方式一：Docker部署（推荐）
最简单的方式，只需要Docker环境即可。

### 方式二：本地开发环境部署
适合开发人员，需要安装Java、Node.js等开发环境。

### 方式三：生产环境部署
适合正式部署，使用Docker Compose进行容器编排。

---

## 📋 方式一：Docker部署（推荐）

### 前置要求
- Docker Desktop 或 Docker Engine
- 8GB+ 内存
- 10GB+ 磁盘空间

### 部署步骤

#### 1. 下载项目
```bash
# 克隆项目（如果有Git仓库）
git clone <项目地址>
cd cultural-heritage-system

# 或者直接下载项目文件
# 将整个项目文件夹发送给其他人
```

#### 2. 启动服务
```bash
# 使用Docker Compose启动所有服务
docker-compose -f docker-compose.simple.yml up -d

# 查看服务状态
docker-compose -f docker-compose.simple.yml ps
```

#### 3. 访问系统
- 前端地址：http://localhost:5173
- 后端API：http://localhost:8080/api
- 数据库：localhost:3306

#### 4. 默认账户
- 管理员：admin / admin123
- 普通用户：user1 / user123

---

## 📋 方式二：本地开发环境部署

### 前置要求
- Java 11+
- Node.js 16+
- MySQL 8.0+
- Redis 6.0+
- Maven 3.6+

### 部署步骤

#### 1. 数据库初始化
```sql
-- 创建数据库
CREATE DATABASE cultural_heritage CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 创建用户
CREATE USER 'heritage_user'@'%' IDENTIFIED BY 'heritage123';
GRANT ALL PRIVILEGES ON cultural_heritage.* TO 'heritage_user'@'%';
FLUSH PRIVILEGES;
```

#### 2. 导入数据库结构
```bash
# 导入SQL文件
mysql -u heritage_user -p cultural_heritage < database/init.sql
```

#### 3. 启动后端
```bash
cd backend
mvn clean package -DskipTests
java -jar target/cultural-heritage-backend.jar
```

#### 4. 启动前端
```bash
cd frontend
npm install
npm run dev
```

---

## 📋 方式三：生产环境部署

### 使用Docker Compose（推荐）

#### 1. 创建生产环境配置
```yaml
# docker-compose.prod.yml
version: '3.8'
services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: cultural_heritage
      MYSQL_USER: heritage_user
      MYSQL_PASSWORD: heritage123
    volumes:
      - mysql_data:/var/lib/mysql
      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"

  redis:
    image: redis:6.2-alpine
    ports:
      - "6379:6379"

  backend:
    build: ./backend
    environment:
      SPRING_PROFILES_ACTIVE: prod
    ports:
      - "8080:8080"
    depends_on:
      - mysql
      - redis

  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - backend

volumes:
  mysql_data:
```

#### 2. 启动生产环境
```bash
docker-compose -f docker-compose.prod.yml up -d
```

---

## 🔧 配置说明

### 环境变量配置
```bash
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_NAME=cultural_heritage
DB_USER=heritage_user
DB_PASSWORD=heritage123

# Redis配置
REDIS_HOST=localhost
REDIS_PORT=6379

# JWT配置
JWT_SECRET=your-secret-key
JWT_EXPIRATION=604800
```

### 端口配置
- 前端：5173 (开发) / 80 (生产)
- 后端：8080
- 数据库：3306
- Redis：6379

---

## 🚀 快速部署脚本

### 一键部署脚本
```bash
#!/bin/bash
# deploy.sh

echo "🚀 开始部署文化遗产管理系统..."

# 检查Docker是否安装
if ! command -v docker &> /dev/null; then
    echo "❌ Docker未安装，请先安装Docker"
    exit 1
fi

# 检查Docker Compose是否安装
if ! command -v docker-compose &> /dev/null; then
    echo "❌ Docker Compose未安装，请先安装Docker Compose"
    exit 1
fi

# 启动服务
echo "📦 启动服务..."
docker-compose -f docker-compose.simple.yml up -d

# 等待服务启动
echo "⏳ 等待服务启动..."
sleep 30

# 检查服务状态
echo "🔍 检查服务状态..."
docker-compose -f docker-compose.simple.yml ps

echo "✅ 部署完成！"
echo "🌐 前端地址: http://localhost:5173"
echo "🔧 后端API: http://localhost:8080/api"
echo "👤 管理员账户: admin / admin123"
```

---

## 📦 项目打包分发

### 创建部署包
```bash
# 创建部署包
tar -czf cultural-heritage-system.tar.gz \
  --exclude=node_modules \
  --exclude=target \
  --exclude=.git \
  cultural-heritage-system/

# 或者使用zip
zip -r cultural-heritage-system.zip cultural-heritage-system/ \
  -x "*/node_modules/*" "*/target/*" "*/.git/*"
```

### 部署包内容
```
cultural-heritage-system/
├── docker-compose.simple.yml    # Docker编排文件
├── backend/                     # 后端代码
├── frontend/                    # 前端代码
├── database/                    # 数据库脚本
├── 部署指南.md                  # 部署说明
├── deploy.sh                    # 一键部署脚本
└── README.md                    # 项目说明
```

---

## 🔍 故障排除

### 常见问题

#### 1. 端口冲突
```bash
# 检查端口占用
netstat -tulpn | grep :5173
netstat -tulpn | grep :8080

# 修改端口
# 编辑 docker-compose.simple.yml 中的端口映射
```

#### 2. 数据库连接失败
```bash
# 检查数据库状态
docker-compose logs mysql

# 重启数据库
docker-compose restart mysql
```

#### 3. 前端无法访问
```bash
# 检查前端服务
docker-compose logs frontend

# 重启前端服务
docker-compose restart frontend
```

#### 4. 权限问题
```bash
# 给脚本执行权限
chmod +x deploy.sh

# 给Docker权限
sudo usermod -aG docker $USER
```

---

## 📞 技术支持

如果遇到问题，请提供以下信息：
1. 操作系统版本
2. Docker版本
3. 错误日志
4. 部署方式

联系方式：
- 邮箱：support@heritage.com
- 文档：查看项目README.md
